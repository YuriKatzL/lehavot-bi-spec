# מסמך אפיון פונקציונלי
## דשבורדים לניתוח מכירות והזמנות

---

| פרט | ערך |
|-----|-----|
| **מסמך מס'** | LHV-BI-SPEC-001 |
| **גרסה** | 2.0 |
| **תאריך** | 04/02/2026 |
| **סטטוס** | טיוטה — ממתין לאישור |
| **מחבר** | יורי כץ |
| **מחלקה** | IT |
| **לקוח** | להבות מערכות כיבוי אש בע"מ |

---

## תוכן עניינים

1. [מבוא ומטרות](#1-מבוא-ומטרות)
2. [הגדרות וקיצורים](#2-הגדרות-וקיצורים)
3. [סגמנטים עסקיים](#3-סגמנטים-עסקיים)
4. [דשבורד מכירות (Sales)](#4-דשבורד-מכירות-sales)
5. [דשבורד הזמנות (Orders)](#5-דשבורד-הזמנות-orders)
6. [מקורות נתונים](#6-מקורות-נתונים)
7. [דרישות טכניות](#7-דרישות-טכניות)
8. [שאלות פתוחות](#8-שאלות-פתוחות)
9. [אישורים](#9-אישורים)

---

## 1. מבוא ומטרות

### 1.1 רקע

מסמך זה מגדיר את הדרישות הפונקציונליות לדשבורדי BI עבור חברת להבות מערכות כיבוי אש בע"מ.

הפרויקט מחולק לשלושה שלבים:

| Phase | תיאור | סטטוס |
|-------|-------|-------|
| **Phase 1** | מודל מכירות/שיווק | נוכחי |
| Phase 2 | מודל פיננסי (תזרים, KPI, גבייה, מסגרות) | עתידי |
| Phase 3 | מודל תפעולי (real-time delivery) | עתידי |

### 1.2 מטרות Phase 1

- מעקב אחר ביצועי מכירות בזמן אמת
- השוואת ביצועים מול תקציב (Budget)
- השוואת ביצועים מול שנה קודמת (YoY)
- מעקב אחר קצב כניסת הזמנות
- ניתוח לפי סגמנטים עסקיים

### 1.3 קהל יעד

- הנהלה בכירה (מנכ"ל, סמנכ"ל כספים)
- מנהלי מכירות
- מנהלי כספים

### 1.4 פלטפורמה

Microsoft Power BI + Priority ERP API

---

## 2. הגדרות וקיצורים

| מונח | הגדרה |
|------|-------|
| MTD | Month-to-Date — מתחילת החודש עד היום |
| QTD | Quarter-to-Date — מתחילת הרבעון עד היום |
| YTD | Year-to-Date — מתחילת השנה עד היום |
| LY | Last Year — שנה קודמת (אותה תקופה) |
| BU | Business Unit — יחידה עסקית / סגמנט |
| Budget | תקציב שנתי מחולק לחודשים |
| Due Date | תאריך אספקה צפוי של הזמנה |

---

## 3. סגמנטים עסקיים

### 3.1 רשימת סגמנטים

| # | סגמנט | תתי-סגמנטים | הערות |
|---|-------|-------------|-------|
| 1 | **מירי** | כולל פז | פז מקבלת עמלות רק על הדילים שלה |
| 2 | **אילן** | — | — |
| 3 | **דודו** | אוטובוסים, מנדפים/מטבחים, כלים חקלאיים, שירות | תתי-סגמנטים מוצגים בנפרד |
| 4 | **חו"ל** | לפי מפיץ (עופר, ירון וכו') | כולל Orders by Due Date |

### 3.2 ציטוט מאלעד

> "בתוך דודו רוצים לראות אוטובוסים לבד, מטבחים לבד, שירות לבד.
> בחו"ל אפשר לחלק בין עופר לירון לפי הסוכן."

### 3.3 מיפוי בפריוריטי

> **❓ שאלה #1 לראובן: מיפוי סגמנטים**
>
> כיצד מזהים בפריוריטי לאיזה סגמנט שייכת מכירה/הזמנה?
>
> **אפשרויות:**
> - [ ] **א.** אני (יורי) אבדוק את הלוגיקה בדוח 740 ואאשר איתך
> - [ ] **ב.** יש לוגיקה אחרת שאתה מעדיף (לא דרך דוח 740)
> - [ ] **ג.** תסביר לי את הלוגיקה ואני אממש
>
> **מה שאני יודע עד עכשיו:**
> דוח 740 משלב: סוכן + לקוח + משפחת מוצרים. צריך לדעת את הכללים המדויקים.

---

## 4. דשבורד מכירות (Sales)

### 4.1 תיאור כללי

דשבורד מכירות מציג ניתוח הכנסות בהשוואה לתקציב ולשנה קודמת.

**ציטוט מאלעד:**
> "בתחילת החודש יופיע תקציב ואפס מכירות, ולאט לאט הפער מצטמצם.
> בסוף החודש רוצים לראות שכולם ב-100% או מעל."

### 4.2 פילטרים

| # | פילטר | סוג | ברירת מחדל | מקור נתונים |
|---|-------|-----|------------|-------------|
| 1 | שנה | Multi-select | שנה נוכחית | `YEAR(DOCUMENTS.CURDATE)` |
| 2 | רבעון | Multi-select | רבעון נוכחי | `DATEPART(Q, CURDATE)` |
| 3 | תקופה | Date Range | חודש נוכחי | `DOCUMENTS.CURDATE` |
| 4 | סגמנט מכירות | Multi-select | הכל | ❓ נדרש מיפוי |
| 5 | מפיץ | Multi-select | הכל | `AGENTS.AGENTCODE` |
| 6 | משפחת מוצרים | Multi-select | הכל | `FAMILY.FAMILYNAME` |
| 7 | חברה | Single-select | מאוחד | `ENVIRONMENT` |

**הערה:** "לא 50K מק"טים, אלא משפחות" — אלעד

### 4.3 כרטיסי סיכום (Summary Cards)

| מדד | תיאור | נוסחה | מקור |
|-----|-------|-------|------|
| % Time Elapsed | אחוז הזמן שעבר בתקופה | יום נוכחי / ימים בתקופה × 100 | `DAY(GETDATE())` |
| % from Budget | אחוז ביצוע מתקציב | מכירות בפועל / תקציב × 100 | ❓ טבלת תקציב |
| % from LY | אחוז משנה שעברה | מכירות השנה / מכירות אשתקד × 100 | `DOCUMENTS` |

**הערה:** הכרטיסים יוצגו עבור MTD, QTD, ו-YTD בנפרד.

### 4.4 טבלת מכירות

| # | עמודה | תיאור | מקור / נוסחה |
|---|-------|-------|--------------|
| 1 | BU | סגמנט עסקי | ❓ נדרש מיפוי |
| 2 | Current Week | מכירות השבוע | `SUM(DOCUMENTS.TOTAL)` |
| 3 | MTD Sales | מכירות מתחילת החודש | `SUM(DOCUMENTS.TOTAL)` |
| 4 | MTD Budget | תקציב יחסי לתקופה | ❓ טבלת תקציב |
| 5 | Full Month Budget | תקציב מלא לחודש | ❓ טבלת תקציב |
| 6 | MTD % from Budget | אחוז ביצוע | עמודה 3 / עמודה 4 |
| 7 | MTD Last Year | אותה תקופה אשתקד | `DOCUMENTS WHERE YEAR-1` |
| 8 | MTD % from LY | אחוז משנה שעברה | עמודה 3 / עמודה 7 |

### 4.5 קידוד צבעים

| צבע | תנאי | משמעות |
|-----|------|--------|
| ירוק | ≥ 100% | עמידה ביעד או מעל |
| כתום | 80% - 99% | קרוב ליעד, דורש תשומת לב |
| אדום | < 80% | מתחת ליעד |

### 4.6 גרפים

| גרף | סוג | נתונים |
|-----|-----|--------|
| התפלגות מכירות | Pie Chart | אחוז מכירות לכל סגמנט |
| ביצוע מול תקציב | Bar Chart | % מתקציב לכל סגמנט |

---

## 5. דשבורד הזמנות (Orders)

### 5.1 תיאור כללי

דשבורד הזמנות מציג ניתוח קצב כניסת הזמנות בהשוואה לשנה קודמת.

**הבדל מ-Sales:** להזמנות אין תקציב — רק השוואה לשנה שעברה.

**ציטוט מאלעד:**
> "אם רוצים לגדול 5%, צריך לראות שקצב כניסת ההזמנות הוא 5% מעל שנה שעברה."

### 5.2 פילטרים

| # | פילטר | סוג | ברירת מחדל | מקור נתונים |
|---|-------|-----|------------|-------------|
| 1 | שנה | Multi-select | שנה נוכחית | `YEAR(ORDERS.CURDATE)` |
| 2 | רבעון | Multi-select | רבעון נוכחי | `DATEPART(Q, CURDATE)` |
| 3 | תקופה | Date Range | חודש נוכחי | `ORDERS.CURDATE` |
| 4 | סגמנט מכירות | Multi-select | הכל | ❓ נדרש מיפוי |
| 5 | מפיץ | Multi-select | הכל | `AGENTS.AGENTCODE` |
| 6 | חברה | Single-select | מאוחד | `ENVIRONMENT` |

### 5.3 כרטיסי סיכום (Summary Cards)

| מדד | תיאור | נוסחה | מקור |
|-----|-------|-------|------|
| % Time Elapsed | אחוז הזמן שעבר בתקופה | יום נוכחי / ימים בתקופה × 100 | `DAY(GETDATE())` |
| % from LY | אחוז משנה שעברה | הזמנות השנה / הזמנות אשתקד × 100 | `ORDERS` |

### 5.4 טבלת הזמנות

| # | עמודה | תיאור | מקור / נוסחה |
|---|-------|-------|--------------|
| 1 | BU | סגמנט עסקי | ❓ נדרש מיפוי |
| 2 | Current Week | הזמנות השבוע | `SUM(ORDERS.TOTAL)` |
| 3 | MTD Orders | הזמנות מתחילת החודש | `SUM(ORDERS.TOTAL)` |
| 4 | MTD Last Year | אותה תקופה אשתקד | `ORDERS WHERE YEAR-1` |
| 5 | MTD % vs LY | אחוז משנה שעברה | עמודה 3 / עמודה 4 |
| 6 | QTD Orders | הזמנות מתחילת הרבעון | `SUM(ORDERS.TOTAL)` |
| 7 | QTD Last Year | אותה תקופה אשתקד | `ORDERS WHERE YEAR-1` |
| 8 | QTD % vs LY | אחוז משנה שעברה | עמודה 6 / עמודה 7 |

### 5.5 קידוד צבעים

| צבע | תנאי | משמעות |
|-----|------|--------|
| ירוק | ≥ 0% | צמיחה — הזמנות גבוהות משנה שעברה |
| אדום | < 0% | ירידה — הזמנות נמוכות משנה שעברה |

### 5.6 Orders by Due Date (חו"ל בלבד)

**תצוגה מיוחדת:** רלוונטי רק לסגמנט חו"ל.

**ציטוט מאלעד:**
> "שאר הסגמנטים = נכנס היום יוצא מחר. בחו"ל יש backlog משמעותי."

| # | עמודה | תיאור | מקור |
|---|-------|-------|------|
| 1 | Due Date | תאריך אספקה צפוי | `ORDERS.DUEDATE` |
| 2 | Open Orders | סכום הזמנות פתוחות | `SUM(ORDERS.TOTAL) WHERE STATUS='Open'` |
| 3 | Distributor | מפיץ | `AGENTS.AGENTNAME` |

> **❓ שאלה #2 לראובן:** איך מזהים הזמנה פתוחה vs סגורה בפריוריטי? שדה ORDSTATUS? ערכים אפשריים?

---

## 6. מקורות נתונים

### 6.1 מערכת מקור

- **מערכת:** Priority ERP
- **גישה:** Priority API (REST)
- **הרשאות:** Read-only בלבד

### 6.2 טבלאות נדרשות

| טבלה | שימוש | גישה |
|------|-------|------|
| `DOCUMENTS` | תעודות משלוח — נתוני מכירות | ❓ לבדוק |
| `ORDERS` | נתוני הזמנות | ❓ לבדוק |
| `CUSTOMERS` | לקוחות — מיפוי לסגמנט | ❓ לבדוק |
| `AGENTS` | סוכנים / מפיצים | ❓ לבדוק |
| `FAMILY` | משפחות מוצרים | ❓ לבדוק |
| `???` | טבלת תקציב | ❓ שם הטבלה? |

### 6.3 מקור נתוני מכירות

**ציטוט מאלעד:**
> "צריך לבחור — תעודות משלוח או חשבוניות?
> כשהחודש נסגר = חשבוניות. בשוטף = תעודות משלוח."

Report 740 (דוח מכירות של שי) מבוסס על תעודות משלוח.

> **❓ שאלה #3 לראובן:** מקור נתוני מכירות — תעודות משלוח או חשבוניות? האם שונה בין שוטף לסגור?

---

## 7. דרישות טכניות

### 7.1 גישה לנתונים

**SQL — לא מומלץ:**
- Priority ממליצה לא לגשת ל-database ישירות
- Read-only אבל אין מעקב, הכל פתוח
- בעיית אבטחה — אם מישהו פורץ, יש גישה לכל המידע

**API — מומלץ:**
- אפשר לתת הרשאות per table
- מבוקר, יש audit
- 25K קריאות בסטוק, read כנראה בחינם

**החלטה:** יורי יתן לאליק VPN + API access.

### 7.2 דרישות תצוגה

- מספרים באלפים (לא 997,000 אלא 997K)
- Default view: רבעון נוכחי, כל הסגמנטים
- ויזואליקה: קווים/פאי/גרפים — אפשר לשנות אחר כך

### 7.3 חברות

| חברה | הערות |
|------|-------|
| להבות | — |
| פיירטק | — |
| מאוחד | ברירת מחדל |

---

## 8. שאלות פתוחות

| # | שאלה | אחראי | סטטוס |
|---|------|-------|-------|
| 1 | מיפוי סגמנטים — איך מזהים בפריוריטי? | ראובן | ❓ פתוח |
| 2 | סטטוס הזמנה — פתוח/סגור בפריוריטי | ראובן | ❓ פתוח |
| 3 | מקור נתונים — ת. משלוח או חשבוניות? | ראובן | ❓ פתוח |
| 4 | טבלת תקציב — שם ומבנה | ראובן | ❓ פתוח |
| 5 | פז ומירי — ביחד או בנפרד? | אלעד | ❓ פתוח |
| 6 | גישת API לטבלאות | יורי | ❓ פתוח |

---

## 9. אישורים

| תפקיד | שם | חתימה | תאריך |
|-------|-----|-------|-------|
| מנכ"ל | אלעד | _______ | _______ |
| סמנכ"ל כספים | ראובן | _______ | _______ |
| IT | יורי כץ | ✓ | 04/02/2026 |

---

## נספח א': תהליך העבודה המוסכם

1. **Elad** — מכין mockup דומה ל-Orders dashboard
2. **Yuri** — מכין draft ויזואלי + מיפוי נתונים
   - לכל שדה: מאיזו טבלה בפריוריטי
   - תהליך איטרטיבי עם הצוות
3. **הגדרת acceptance criteria** — מה בודקים ב-Beta test
4. **פגישה עם אליק** — להציג את האפיון המדויק
5. **אליק** — נותן הצעת מחיר ובונה
6. **בדיקות** — מוודאים כל נתון מול פריוריטי

**ציטוט מיורי:**
> "אנחנו חייבים להגיע למצב שברגע שאליק סיים, אנחנו בודקים ואומרים 'כן, זה מתאים'.
> כמה שאנחנו נדייק עכשיו, יהיה לנו פחות הרפתקאות אחר כך."

**ציטוט מאלעד:**
> "נכון. לא רוצים מצב של 'לא הבנתי, לא התכוונתי, זה לא בסקופ'."

---

**סוף מסמך**

מסמך מס' LHV-BI-SPEC-001 | גרסה 2.0 | סודי — לשימוש פנימי בלבד
